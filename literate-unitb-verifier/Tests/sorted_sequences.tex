
\documentclass[12pt]{amsart}
\usepackage{geometry} % see geometry.pdf on how to lay out the page. There's lots.
\geometry{a4paper} % or letter or a5paper or ... etc
% \geometry{landscape} % rotated page geometry
\usepackage{amsmath}
\usepackage{unitb}
\usepackage{calculational}

% See the ``Article customise'' template for come common customisations

\title{Sorted Sequences}
\author{Simon Hudon}
\date{} % delete this line to display the current date

\newcounter{thm}
\setcounter{thm}{-1}
\newtheorem{theorem}[thm]{Theorem}
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{axiom}[thm]{Hypothesis}

\usepackage{xifthen}% provides \isempty test

%\newcommand{\optarg}[1][]{%
%  \ifthenelse{\isempty{#1}}%
%    {}% if #1 is empty
%    {(((#1)))}% if #1 is not empty
%}

%\newcounter{prop}
%\setcounter{prop}{-1}
%%\newcommand{\proptag}{}
%\newenvironment{assertion}[3] % {label prefix}{counter}{label}
%{	%\renewcommand{\proptag}{#1}
%	\begin{equation}
%	\ifthenelse{\isempty{#2}} 
%	{	\stepcounter{prop}
%		\tag{#1\arabic{prop}} }
%	{	\stepcounter{#2}
%		\tag{#2:#1\arabic{#2}} }
%	\label{#3} } 
%{ 	\end{equation} }
%
%\newcommand{\newassertion}[2] % {invariant}{J}
%{ 	%\newcounter{cnt:#1}
%	\newenvironment{#1}
%	{	\begin{assertion}{#2}{}  } % {label}
%	{	 \end{assertion} } }
%%\newcommand{\newdeclaration}
%\newcommand{\newcompound}[1] % {evt}
%{	\newcounter{#1}
%	\setcounter{#1}{-1} }
%\newcommand{\newcomponent}[2] % {assignment}{A}
%{	\newenvironment{#1}
%	{	\begin{assertion}{#2} } % {counter}{label}
%	{	\end{assertion} } }
%
%%\newcomponent
%\newassertion{invariant}{J}
%\newcomponent{guard}{G}
%\newcomponent{f:schedule}{F}
%\newcomponent{c:schedule}{C}
%\newcomponent{assignment}{A}
%\newenvironment{invariant}[1]
%	{	\begin{assertion}{J}{#1} }
%	{	\end{assertion} }
%\newenvironment{guard}[1]
%	{	\begin{assertion}{G}{#1} }
%	{	\end{assertion} }
%\newenvironment{f:schedule}[1]
%	{	\begin{assertion}{F}{#1} }
%	{	\end{assertion} }
%\newenvironment{c:schedule}[1]
%	{	\begin{assertion}{C}{#1} }
%	{	\end{assertion} }
%\newenvironment{assignment}[1]
%	{	\begin{assertion}{A}{#1} }
%	{	\end{assertion} }

%%% BEGIN DOCUMENT
\begin{document}

\maketitle
%\tableofcontents
%
\begin{axiom} \label{axm0}
	\[ \ew{ q \le p } \]
\end{axiom}
\begin{theorem}
	\[ \ew{ sort.q \le sort.p } \]
\end{theorem}
\begin{proof}
\begin{calculation}
		  sort.p.n  \le  x
	\hint{=}{ \eqref{lmm1} }
		  n+1  ~\le~  \quant{+}{i}{p.i \le x}{1}
	\hint{\implies}{ $\ew{ q \le p }$: \eqref{axm0} }
		  n+1  ~\le~ \quant{+}{i}{q.i \le x}{1}
	\hint{=}{ \eqref{lmm1} }
		  sort.q.n \le x
\end{calculation}
\end{proof}
\begin{lemma} \label{lmm1}
	\[ sort.p.n  \le  x   \quad \equiv \quad   n+1 \le \quant{+}{i}{p.i \le x}{1} \]
\end{lemma}

\begin{axiom} \label{lmm2}
For all $p$,
	\[ \ew{ b.( \, sort.p\, ) = b.p } \]
\end{axiom}
\begin{proof}[Proof of \eqref{lmm1}]
\begin{calculation}
		  sort.p.n  \le  x
	\hint{=}{ \eqref{lmm3} }
		  n+1 ~\le~ \quant{+}{ i}{  sort.p.i \le x}{ 1 }
	\hint{=}{ (8) }
		  n+1 \1\le \quant{+}{ y}{ y \le x}{ b.( sort.p ).y }
	\hint{=}{ \eqref{lmm2} }
		  n+1 \1\le \quant{+}{ y}{ y \le x}{ b.p.y}
	\hint{=}{ (8) }
		  n+1 \1\le \quant{+}{i}{p.i \le x}{ 1}
\end{calculation}
\end{proof}
%\arabic{prop}
\begin{invariant}{inv0}
	\qforall{i,j}{gr.i \land gr.j}{i = j}
\end{invariant}
\begin{invariant}{inv1}
	7
\end{invariant}

We preserve \ref{inv0}, \ref{inv1}

\newcompound{evt0}

\begin{ev:guard}{evt0}{grd0}
	x \le y
\end{ev:guard}

\begin{ev:guard}{evt0}{grd1}
	x \le z
\end{ev:guard}
\ref{grd1} and \ref{grd0}

\newcompound{evt1}

\begin{ev:guard}{evt1}{grd2}
	x \le y
\end{ev:guard}

\begin{ev:guard}{evt1}{grd3}
	x \le z
\end{ev:guard}
\ref{grd2} and \ref{grd3}


\end{document}